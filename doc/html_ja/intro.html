<!DOCTYPE html>
<html lang="ja-JP">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>OpenNovel マニュアル</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>

<h1>OpenNovel 入門編</h1>

<h2>OpenNovelの使い方</h2>
<p>
	このチュートリアルでは、OpenNovelを使ってゲームを作成する方法を説明します。
</p>
<p>
	内容はとてもかんたんで、1時間もあれば取り組めます。
</p>

<h2>セットアップ編</h2>
<p>
	ここではWindowsを使います。最新のファイルをダウンロードして展開しておきます。
</p>

<h2>ゲームフォルダを確認する</h2>
<p>
	<code>sample</code> フォルダを開いてみます。
	それぞれのフォルダがゲームの中身です。ファイルの振り分けは下記のようになっています。
</p>
<ul>
	<li>story ... ストーリー</li>
	<li>image ... 画像
		<ul>
			<li>bg ... 背景</li>
			<li>ch ... キャラ</li>
			<li>emoji ... 絵文字</li>
			<li>rule ... ユニバーサルトランジション</li>
			<li>system ... テーマ</li>
			<li>title ... タイトル画面</li>
		</ul>
	</li>
	<li>sound ... サウンド
		<ul>
			<li>music ... BGM</li>
			<li>effect ... 効果音</li>
			<li>voice ... 声</li>
		</ul>
	</li>
	<li>script ... 各種スクリプト
		<ul>
			<li>anime ... アニメ</li>
			<li>menu ... メニュー</li>
			<li>plugin ... プラグイン</li>
		</ul>
	</li>
	<li>font ... フォント</li>
	<li>video ... 動画</li>
	<li>project.txt ... 設定ファイル</li>
</ul>

<h2>実行方法</h2>
<p>
	実行ファイルの <code>game-win.exe</code> を <code>sample</code> フォルダにコピーして実行します。
</p>

<h2>背景を表示する方法</h2>
<p>
	最初に実行されるストーリーは <code>story/story.txt</code> というファイルです。
	ここで一度、テキストの中身をすべて削除して、次の内容を貼り付けて保存し、実行してみてください。
</p>

<pre><code>@bg roof.png 1.0</code></pre>

<p>
	屋上の背景が表示されるはずです。
	<code>@bg</code> というのが背景を表示する命令です。
	<code>roof.png</code> は <code>image/bg</code> フォルダの中のファイル名です。
	<code>1.0</code> は画面の表示が完了するまでの時間(秒)です。
</p>

<h2>キャラを表示する方法</h2>
<p>
	背景を表示できたところで、次はキャラクタの表示に移ります。
	<code>story.txt</code> の中身をすべて削除して、次の内容を貼り付け、実行します。
</p>

<pre><code>@bg roof.png 1.0
@ch center chara001.png 1.0</code></pre>

<p>
	屋上の背景が表示され、続いてキャラクタが表示され、クリックを行うと、終了するはずです。
	<code>@ch</code> というのがキャラクタを表示するコマンドです。
	<code>center</code> は表示位置(中央)です。
	<code>chara001.png</code> は <code>image/ch</code> フォルダの中のファイル名です。
	<code>1.0</code> はフェードインの時間(秒)です。
</p>

<h2>メッセージとセリフを表示する方法</h2>
<p>
	背景、キャラクタを表示できたところで、次はメッセージとセリフの表示に移ります。
	<code>story.txt</code> の中身をすべて削除し、次の内容を貼り付け、実行してみてください。
</p>

<pre><code>@bg roof.png 1.0
@ch center chara001.png 1.0
メッセージボックスにテキストを表示するのが"メッセージ"です。
なまえ「キャラクタの名前を付けたメッセージが"セリフ"です。」
*なまえ*001.ogg*セリフにはボイスをつけることができます。</code></pre>

<p>
	先ほどのキャラクタが表示されたあと、メッセージとセリフが表示されるはずです。
</p>
<p>
	名前付きのセリフとして認識される行は、先頭が <code>*</code> で始まる行か、<code>名前「メッセージ」</code>の形式の行です。
	また、名前の付かないメッセージとして認識される行は、 普通の文章の行(先頭が <code>@</code> や <code>*</code> や <code>:</code> ではない行)です。
</p>

<h2>音楽を再生する方法</h2>
<p>
	メッセージ、セリフを表示できたところで、次はBGMの再生に移ります。
	<code>story.txt</code> の中身をすべて削除して、次の内容を貼り付け、実行してみてください。
</p>

<pre><code>@bgm 01.ogg
@bg roof.png 1.0
@ch center chara001.png 1.0</code></pre>

<p>
	BGMが再生され、先ほどのキャラクタが表示されるはずです。
	<code>@music</code> はBGM再生コマンドを表します。
	<code>01.ogg</code> は <code>bgm</code> フォルダのファイル名を表します。
</p>

<p>
	再生できるファイルは、44.1kHzのOgg Vorbis形式です。ステレオ、モノラルのどちらでも構いません。
</p>

<h2>選択肢を表示する方法</h2>
<p>
	BGMの再生ができたところで、次は選択肢の表示に移ります。
	<code>story.txt</code> の中身をすべて削除して、次の内容を貼り付け、実行してみてください。
</p>

<pre><code>@bg roof.png 1.0
@ch center chara001.png 1.0
さて、学校へ行くか。
@choose WALK 歩いて行こう BIKE 自転車で行こう
:WALK
歩いて行くことにした。
@goto end
:BIKE
自転車で行くことにした。
@goto end
:end</code></pre>

<p>
	コピペしたら、ゲームを実行します。2つの選択肢が表示されるはずです。
	<code>@choose</code> は選択肢命令を表し、<code>WALK</code>, <code>BIKE</code> は選択肢が選ばれたときにジャンプする先のラベルです(後述)。
	ラベル名と選択肢のテキストが一組のセットです。
	<code>:WALK</code> は、ジャンプ先として指定されるラベルです。
	ラベルの行は、ゲームの見た目の上では何も実行されません。
</p>

<h3>より便利な書き方</h3>
<p>
	別な書き方として、次のようなスタイルもあります。
	この場合、ラベルは省略できます。
	お好みの方法を使ってください。
</p>

<pre><code>@bg roof.png 1.0
@ch center chara001.png 1.0
さて、学校へ行くか。

&lt;&lt;&lt;
switch "歩いて行こう" "自転車で行こう" {
case "歩いて行こう":
    歩いて行くことにした。
    break
case "自転車で行こう":
    自転車で行くことにした。
    break
}
&gt;&gt;&gt;</code></pre>

<h2>シナリオを分岐させる方法</h2>
<p>
	選択肢の表示ができたところで、次はフラグを立てて分岐する処理に移ります。
	これができればゲームがひとまず形になります。
	<code>story.txt</code> の中身をすべて削除して、次の内容を貼り付け、実行してみてください。
</p>

<pre><code>@bg roof.png 1.0
@ch center chara001.png 1.0

さて、学校へ行くか。

&lt;&lt;&lt;
switch "歩いて行こう" "自転車で行こう" {
case "歩いて行こう":
    歩いて行くことにした。
    @set $1 = true
    break
case "自転車で行こう":
    自転車で行くことにした。
   break
}
&gt;&gt;&gt;

@if $1 == false NO_MONEY

お金を拾った。

:NO_MONEY</code></pre>

<p>
	保存したら、ゲームを実行します。
	「歩いて行こう」を選択した場合だけ、「お金を拾った。」が表示されるはずです。
</p>

<h3>仕組み</h3>
<p>
	ここでは @set と @if を組み合わせています。
</p>
<p>
	<code>@set</code> は、フラフを立てるコマンドです。
	続く <code>$1</code> は、変数番号 <code>1</code> に値 <code>true</code> をセットすることを意味します。
	続く <code>=</code> は、単純な代入であることを意味します(他にも計算ができますが、ここでは割愛します)。
	<code>true</code> は、整数の <code>1</code> を代入することを意味します。
	変数の初期値は <code>0</code>、つまり <code>false</code> ですので、「歩いて行こう」が選択されたときだけ、変数 <code>$1</code> の値が <code>true</code> になります。
</p>
<p>
	<code>@if</code> は、条件分岐です。
	<code>$1 == false</code> は、変数 <code>$1</code> の値が <code>false</code>、つまり <code>0</code> の場合、という条件を意味します。
	<code>NO_MONEY</code> は、ラベルの名前です。条件に一致したとき、<code>:NO_MONEY</code> という行にジャンプします。
	変数の初期値は <code>0</code>、つまり <code>false</code> ですので、結果として、「歩いて行こう」を選択した場合だけ、「お金を拾った。」が表示されることになります。
</p>
<p>
	変数の使い方は0/1やfalse/trueのフラグだけではなく、好感度などの数値を持つこともできます。
	詳細はコマンド・リファレンスの @set と @if をご覧ください。
	ただ、スクリプトをシンプルに保つためには、なるべく0/1のフラグとして運用する方が望ましいと思います。
</p>

<h3>より便利な書き方</h3>
<p>
	ちなみに、@if を便利にした書き方もあります。拡張if文と呼ばれています。
	ラベルやジャンプがよくわからないときは、この書き方を使ってみてください。
</p>

<pre><code>&lt;&lt;&lt;
if $1 == 0 {
  お金を拾った。
}
&gt;&gt;&gt;</code></pre>

<p>
	この書き方では、<code>&lt;&lt;&lt;</code> から <code>&gt;&gt;&gt;</code> までの区間で拡張構文が有効になります。途中で <code>&lt;&lt;&lt;</code> が再び現れても、それはただのメッセージとして表示されてしまいますのでご注意ください。
</p>

<h2>メニュー画面を表示させる方法</h2>

<p>
	シナリオの分岐ができたところで、 ちょっとステップアップして、 タイトル画面やメニュー画面の作成方法を説明します。
	story.txt の中身をすべて削除して、次の内容を貼り付け、実行してみてください。
</p>

<pre><code>@menu title.txt
:START
:LOAD
:CONFIG
:QUIT</code></pre>

<p>
	ゲームを実行すると、タイトル画面が表示されるはずです。
	詳しく見ていきます。
</p>
<p>
	<code>@menu title.txt</code> というコマンドは、メニュー画面(GUIと呼ばれる)を表示するコマンドです。
	これは <code>script/menu</code> フォルダの <code>title.txt</code> というファイルで設定されているメニュー画面を表示しています。
	<code>title.txt</code> はメニューファイルと呼ばれています。
</p>
<p>
	メニューファイルの書き方については、<a href="menu.html">こちら</a> を参照 してください。
	何やら難しそうと思われるかもしれませんが、画像のレイヤーを理解していれば、とても便利に使っていただけます。
</p>

<h2>ストーリーファイルを分割する方法</h2>
<p>
	シナリオの分量が大きくなってくると、1つのストーリーファイルで書くのが大変になります。
	そこで、シナリオの章やシーンごとにストーリーファイルを分割する方法があります。
	<code>story</code> フォルダの中に、<code>story.txt</code> のコピーを作成して、<code>second.txt</code> と名付けてください。
</p>
<p>
	次の内容を貼り付け、保存してみてください。
</p>

<p>story.txt:</p>
<pre><code>@bg roof.png 1.0
@ch center chara001.png 1.0
init.txtの中にいます。
@story second.txt</code></pre>

<p>second.txt:</p>
<pre><code>second.txtに移動しました。</code></pre>

<p>
	保存したら、ゲームを実行してみてください。
	second.txtに移動できたことがわかるはずです。
</p>

<h2>素材ファイルをパッケージにまとめて見えなくする方法</h2>
<p>
	<code>exporter.exe</code> を使ってください。
</p>

</body>
</html>
